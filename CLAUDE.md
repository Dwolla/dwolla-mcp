# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **Dwolla API MCP Server** - a Model Context Protocol server that exposes Dwolla's payment API functionality to MCP-compatible clients like Claude and Cursor. The codebase is entirely generated by Speakeasy and provides 87+ tools covering the complete Dwolla API.

## Development Commands

```bash
# Build the project
npm run build          # Runs bun build + TypeScript compilation

# Linting and validation  
npm run lint           # ESLint with TypeScript rules
npm run check          # Alias for lint

# Development
bun run bin/mcp-server.js --help  # View CLI options
```

## Architecture

### Core Structure
- **Language**: TypeScript with ES modules
- **Runtime**: Bun for build, Node.js for execution
- **Entry Point**: `bin/mcp-server.js` (CLI executable)
- **Build Output**: `esm/` directory with compiled JS + declarations

### Key Directories
```
src/
├── mcp-server/          # MCP server implementation and tool definitions
├── funcs/              # API function wrappers (87+ functions)
├── models/             # Dwolla API type definitions
├── lib/                # Core utilities and client
├── hooks/              # Authentication hooks
└── types/              # Additional type definitions
```

### Authentication Architecture
Currently uses **session-based authentication**:
- Server requires startup credentials: `--client-id`, `--client-secret`, `--bearer-auth`
- Single `DwollaMcpCore` client instance shared across all tools
- All API calls use the pre-authenticated session

**Important**: The `spec.md` file outlines plans to migrate to a stateless architecture with per-request authentication.

### Tool Implementation Pattern
All 87+ MCP tools follow this consistent pattern:
```typescript
export const tool$endpoint: ToolDefinition<typeof args> = {
  name: "tool-name",
  description: "Description",
  args: { request: ZodSchema },
  tool: async (client, args, ctx) => {
    const [result, apiCall] = await api_function(client, args.request).$inspect();
    return formatResult(result, { response: apiCall?.response });
  }
};
```

### Transport Configuration
- **STDIO**: Primary transport for Claude Desktop integration
- **SSE**: HTTP-based transport (currently implemented but deprecated)
- **Planned**: Migration to StreamableHTTP transport per MCP protocol v2024-11-05

## Code Generation

**Critical**: This is a fully generated codebase. All files contain `/* Code generated by Speakeasy */` headers. Manual modifications will be overwritten during regeneration.

## Environment Support

The server supports both Dwolla sandbox and production environments through environment-specific URLs and credentials.

## Integration Examples

The server can be integrated with:
- **Claude Desktop**: Via `claude_desktop_config.json`
- **Cursor**: Via `.cursor/mcp.json`  
- **Standalone**: As binary executable
- **Package managers**: npm, pnpm, bun, yarn

## API Coverage

Provides comprehensive Dwolla API access through MCP tools:
- Account operations (20+ tools)
- Customer management (15+ tools)
- Payment processing (15+ tools) 
- Compliance and KBA (10+ tools)
- Document management (5+ tools)
- Webhook system (7+ tools)
- Exchange integrations (8+ tools)